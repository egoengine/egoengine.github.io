<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EgoEngine — global swipe</title>
<style>
  :root { --divider-x: 50vw; --bg:#0b0b0c; --line:rgba(255,255,255,.95); }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:#eaeaea;font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* ZERO gaps grid */
  .grid{
    display:grid; grid-template-columns:repeat(6,1fr);
    gap:0; width:100vw; max-width:100vw; margin:0 auto;
  }
  @media (max-width:1400px){.grid{grid-template-columns:repeat(5,1fr)}}
  @media (max-width:1100px){.grid{grid-template-columns:repeat(4,1fr)}}
  @media (max-width:900px){ .grid{grid-template-columns:repeat(3,1fr)}}
  @media (max-width:640px){ .grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:420px){ .grid{grid-template-columns:1fr}}

  .tile{ position:relative; aspect-ratio:1/1; overflow:hidden; background:#000; }

  .tile video{
    position:absolute; inset:0; width:100%; height:100%;
    object-fit:cover; display:block; background:#000;
  }
  /* 底层：inpainted */
  .tile video.base   { z-index:1; }
  /* 上层：cropped（被 clip-path 从左侧裁出）*/
  .tile video.overlay{ z-index:2; clip-path: polygon(0 0, var(--cut,0px) 0, var(--cut,0px) 100%, 0 100%); }

  /* ONE global divider line */
  #divider{
    position:fixed; top:0; bottom:0; left:var(--divider-x); width:2px;
    background:var(--line); transform:translateX(-1px); pointer-events:none; z-index:999;
  }
</style>
</head>
<body>
  <div id="divider"></div>
  <main id="grid" class="grid"></main>

<script>
  // —— 根据你的仓库结构：index.html 同级 videos/...
  const ROOT = 'videos/blending/human';
  const FOLDERS = [
    'Cassie-bartending','Cassie-bartending2','Cassie-blinds','Cassie-boardgame','Cassie-cat2','Cassie-cat_food',
    'Cassie-cooking2','Cassie-door','Cassie-earbuds','Cassie-eyedrops','Cassie-flower','Cassie-fridge',
    'Cassie-laptop','Cassie-microwave','Cassie-oven','Cassie-subway','Cassie-yogurt','Cassie-Rowan-Allen',
  ];

  function makeVideo(src, cls){
    const v = document.createElement('video');
    v.className = cls || '';
    v.autoplay = true; v.loop = true; v.muted = true; v.playsInline = true;
    v.setAttribute('muted',''); v.setAttribute('playsinline','');
    v.preload = 'auto';
    v.src = src;            // 去掉 #t=0.001 等花活，最稳
    v.addEventListener('error', () => console.warn('video error:', src));
    // 尽量触发播放
    const tryPlay = () => v.play().catch(()=>{});
    v.addEventListener('canplay', tryPlay);
    v.addEventListener('loadeddata', tryPlay);
    v.addEventListener('mouseenter', tryPlay);
    v.addEventListener('touchstart', tryPlay, {passive:true});
    return v;
  }

  const grid = document.getElementById('grid');

  // 构建 18 组 tile：底层 inpainted（右边可见）、上层 cropped（左边随分割线出现）
  (function build(){
    for(const name of FOLDERS){
      const tile = document.createElement('div'); tile.className = 'tile';
      const inpainted = makeVideo(`${ROOT}/${name}/inpainted_video.mp4`, 'base');
      const cropped   = makeVideo(`${ROOT}/${name}/cropped_video.mp4`,   'overlay');
      tile.append(inpainted, cropped);
      grid.appendChild(tile);
    }
    // 初始裁剪
    requestAnimationFrame(()=>{ updateDivider(); updateClips(); });
  })();

  // —— 全局一条分割线控制所有 tile 的裁剪宽度
  let cutX = Math.round(window.innerWidth * 0.5);
  function updateDivider(){
    document.documentElement.style.setProperty('--divider-x', cutX + 'px');
  }
  function updateClips(){
    document.querySelectorAll('.tile').forEach(tile=>{
      const r = tile.getBoundingClientRect();
      const local = Math.max(0, Math.min(r.width, cutX - r.left)); // 将全局 x 转为该 tile 的局部宽度
      tile.style.setProperty('--cut', local + 'px');
    });
  }
  function setCutFrom(x){
    cutX = Math.max(0, Math.min(window.innerWidth, x));
    updateDivider(); updateClips();
  }
  window.addEventListener('mousemove', e=> setCutFrom(e.clientX));
  window.addEventListener('touchstart', e=> e.touches[0] && setCutFrom(e.touches[0].clientX), {passive:true});
  window.addEventListener('touchmove',  e=> e.touches[0] && setCutFrom(e.touches[0].clientX), {passive:true});
  window.addEventListener('resize', ()=> { updateDivider(); updateClips(); });
</script>
</body>
</html>
